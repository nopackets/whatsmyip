<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guess Your City</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
  :root {
    --bg-blur: 12px;
    --radius: 14px;
    --shadow: 0 8px 30px rgba(0, 0, 0, 0.18);
    --accent1: #6d28d9;
    --accent2: #3b82f6;
    --good: #22c55e;
    --ok: #eab308;
    --bad: #ef4444;
    --text-dark: #0f172a;
    --text-muted: #64748b;
    font-family: Inter, system-ui, sans-serif;
  }

  body {
    margin: 0;
    background: #f7f8fc;
  }

  body::before {
    content: "";
    position: fixed;
    inset: 0;
    background-size: cover;
    background-position: center;
    filter: saturate(0.9) brightness(0.95);
    z-index: -2;
  }

  .wrap {
    width: min(900px, 94%);
    margin: 40px auto;
    background: rgba(255,255,255,0.65);
    backdrop-filter: blur(var(--bg-blur));
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 22px;
    display: grid;
    grid-template-columns: 360px 1fr;
    gap: 20px;
  }

  h1 {
    margin: 0;
    font-size: 22px;
    font-weight: 700;
    color: var(--text-dark);
  }

  .meta {
    font-size: 13px;
    color: var(--text-muted);
  }

  .map-box {
    width: 100%;
    height: 440px;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.08);
  }

  #map {
    width: 100%;
    height: 100%;
  }

  .controls {
    display: flex;
    gap: 10px;
    margin-top: 8px;
  }

  button {
    border: none;
    padding: 10px 14px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.15s ease;
  }

  .btn-main {
    background: linear-gradient(90deg, var(--accent1), var(--accent2));
    color: #fff;
  }

  .btn-ghost {
    background: rgba(255,255,255,0.55);
    border: 1px solid rgba(0,0,0,0.1);
    color: var(--text-dark);
  }

  .panel {
    background: rgba(255,255,255,0.75);
    padding: 14px;
    border-radius: 12px;
    margin-bottom: 14px;
  }

  .result-head {
    font-size: 15px;
    color: var(--text-muted);
  }

  .result-main {
    font-size: 18px;
    font-weight: 700;
    margin-top: 6px;
    color: var(--text-dark);
  }

  .badge {
    display: inline-block;
    margin-top: 10px;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 600;
  }

  .b-good { background: rgba(34,197,94,0.15); color: var(--good); }
  .b-ok { background: rgba(234,179,8,0.15); color: var(--ok); }
  .b-bad { background: rgba(239,68,68,0.15); color: var(--bad); }

  ul {
    margin: 0;
    padding-left: 18px;
    color: var(--text-dark);
  }
</style>
</head>
<body>

<div class="wrap">

  <div>
    <h1>Guess Your City</h1>
    <div class="meta">Place a 5 km radius guess on the map</div>

    <div class="map-box">
      <div id="map"></div>
    </div>

    <div class="meta" id="ip">IP: —</div>
    <div class="meta" id="country">Country: —</div>

    <div class="controls">
      <button class="btn-main" id="reset">Reset</button>
      <button class="btn-ghost" id="zoom">Zoom to Country</button>
    </div>
  </div>

  <div>
    <div class="panel">
      <div class="result-head">Result</div>
      <div id="result" class="result-main">Click on the map to guess.</div>
      <div id="detail" class="meta" style="margin-top:6px"></div>
      <div id="badge"></div>
      <div class="meta" style="margin-top:10px">Distance: <b id="km">—</b></div>
    </div>

    <div class="panel">
      <div class="result-head">How it works</div>
      <ul>
        <li>Click anywhere on the map to make a guess.</li>
        <li>If you're within 10 km, your exact city is revealed.</li>
        <li>Otherwise you only get distance + feedback.</li>
      </ul>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  function dist(a, b, c, d) {
    const R = 6371;
    const dLat = (c - a) * Math.PI / 180;
    const dLon = (d - b) * Math.PI / 180;
    const x = Math.sin(dLat/2)**2 +
      Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180) *
      Math.sin(dLon/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(x), Math.sqrt(1-x));
  }

  let map, realLat, realLon, realCity;
  let guessCircle = null;
  let realMarker = null;
  let toggle = true;

  async function loadData() {
    const r = await fetch("https://geolocation-db.com/json/");
    const d = await r.json();

    realLat = d.latitude;
    realLon = d.longitude;
    realCity = d.city;

    document.getElementById("ip").textContent = "IP: " + d.IPv4;
    document.getElementById("country").textContent = "Country: " + d.country_name;

    const bg = `https://source.unsplash.com/1600x900/?${encodeURIComponent(d.country_name + " landscape")}`;
    document.body.style.setProperty("--bg-img", bg);

    document.querySelector("body::before");
    const s = document.createElement("style");
    s.innerHTML = `body::before { background-image: url("${bg}"); }`;
    document.head.appendChild(s);

    map = L.map("map").setView([realLat, realLon], 6);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
    map.on("click", clicked);
  }

  function clicked(e) {
    const a = e.latlng.lat;
    const b = e.latlng.lng;

    if (guessCircle) map.removeLayer(guessCircle);
    guessCircle = L.circle([a,b], {
      radius: 5000,
      color: "#3b82f6",
      weight: 2,
      fillColor: "#3b82f6",
      fillOpacity: 0.12
    }).addTo(map);

    const k = Math.round(dist(realLat, realLon, a, b));
    document.getElementById("km").textContent = k + " km";

    const r = document.getElementById("result");
    const d = document.getElementById("detail");
    const bEl = document.getElementById("badge");

    if (k <= 10) {
      if (realMarker) map.removeLayer(realMarker);
      realMarker = L.marker([realLat, realLon]).addTo(map);
      r.textContent = `You got it! ${realCity}`;
      d.textContent = "Close enough to reveal the city.";
      bEl.innerHTML = `<span class="badge b-good">Excellent</span>`;
      guessCircle.setStyle({ color: "#22c55e", fillColor: "#22c55e", fillOpacity:0.18 });
    } else if (k < 20) {
      r.textContent = k + " km away.";
      d.textContent = "Pretty close!";
      bEl.innerHTML = `<span class="badge b-ok">Close</span>`;
      guessCircle.setStyle({ color: "#eab308", fillColor: "#eab308", fillOpacity:0.12 });
    } else {
      r.textContent = k + " km away.";
      d.textContent = "Not close enough to reveal.";
      bEl.innerHTML = `<span class="badge b-bad">Far</span>`;
      guessCircle.setStyle({ color: "#ef4444", fillColor: "#ef4444", fillOpacity:0.10 });
    }
  }

  document.getElementById("reset").onclick = () => {
    if (guessCircle) map.removeLayer(guessCircle);
    if (realMarker) map.removeLayer(realMarker);
    guessCircle = null;
    realMarker = null;
    document.getElementById("result").textContent = "Click on the map to guess.";
    document.getElementById("detail").textContent = "";
    document.getElementById("badge").innerHTML = "";
    document.getElementById("km").textContent = "—";
  };

  document.getElementById("zoom").onclick = () => {
    map.setView([realLat, realLon], toggle ? 9 : 6);
    toggle = !toggle;
  };

  loadData();
</script>
</body>
</html>

